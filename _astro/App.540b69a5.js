import{j as k,e as s,g as n,f as v,i as c,r as w,t as l,s as U,h as R,S as D,F as j,q,w as J}from"./web.9ee1b91f.js";import{u as K}from"./index.c584f020.js";import{c as O,A as V,C as T}from"./index.79db8632.js";import{M as A,a as Q}from"./MessageHInt.3d0a2276.js";import{N as f}from"./notice.940364ec.js";import{U as W}from"./index.4f2c4b12.js";import{X as Y,d as Z,e as ee,t as X,w as te}from"./index.b92d985b.js";import{G as C}from"./GlobalData.4e554cac.js";import{u as se,F as L}from"./FileSaver.min.1c20ed5c.js";import"./useIndexedDB.84c7bc09.js";import{P as ne}from"./Panel.801c2a10.js";import{U as z}from"./UploadButton.81194c33.js";/* empty css                       */import"./_commonjsHelpers.edff4021.js";import"https://cdn.jsdelivr.net/npm/viewerjs@1.11.2/dist/viewer.esm.min.js";import"./preload-helper.101896b7.js";import"./md5.0fe766d4.js";import"./memoize.49269b7f.js";const ie=l("<span>查看魔咒</span>",2),le=l('<section class="flex gap-2 py-2"><!#><!/><span class="font-icon btn whitespace-nowrap bg-green-600 text-sm text-white">✒️</span><span class="font-icon btn mr-2 whitespace-nowrap bg-sky-600 text-sm text-white">📄</span></section>',8),ue=l('<div class=" pointer-events-none mt-2  w-[70vw] whitespace-pre-wrap rounded-md border border-slate-600 bg-slate-800 p-2 text-left text-sm"></div>',2),re=i=>{const{ChangeMagic:a}=C.getApp("notebook");return s(V,{send:(t,g)=>{t("INPUT_MAGIC",i.data().tags),g.setData("text",i.data().tags),A.success("您可以拖拽魔咒到其他页面")},get children(){const t=n(le),g=t.firstChild,[u,m]=v(g.nextSibling),d=u.nextSibling,$=d.nextSibling;return c(t,s(Y,{class:"btn flex-1 whitespace-nowrap text-sm text-white",animateProps:{anime:"scale"},popup:()=>(()=>{const r=n(ue);return c(r,()=>i.data().tags),r})(),get children(){return n(ie)}}),u,m),d.$$click=r=>{r.stopPropagation();const _=prompt("请修改魔咒",i.data().tags);_&&a({...i.data(),tags:_}).then(()=>i.data.refetch()).then(()=>{f.success("修改魔咒成功")})},$.$$click=()=>{O(i.data().tags),f.success("复制成功")},w(),t}})};k(["click"]);const ce=l('<img loading="lazy" class="h-full w-full  object-cover " alt="">',1),ae=i=>{const a=W(i.fetch),{replaceImages:t,getViewer:g}=se();return s(D,{get when(){return a.isReady()},fallback:"加载中",get children(){const u=n(ce);return u.$$click=()=>{t([{src:a(),origin:a(),alt:a()}]),g().view(0)},U(u,"draggable",!1),u.style.setProperty("min-height","100%"),u.style.setProperty("min-width","100%"),R(()=>U(u,"src",a())),w(),u}})};k(["click"]);const oe=l(`<div class="h-32 w-32 flex-none cursor-pointer overflow-hidden rounded-lg" title="点击查看
拖动到删除按钮删除"></div>`,2),de=i=>{const{getImage:a}=C.getApp("notebook");return s(V,{send:t=>t("MAGIC_IMAGE",{origin:i.data,position:i.id}),get children(){const t=n(oe);return c(t,s(ae,{fetch:()=>a(i.id)})),t}})},pe=l('<div class="grid grid-cols-1 gap-4 overflow-y-scroll py-2 pb-24 md:grid-cols-2"></div>',2),ge=l('<div class="w-full text-center"><div class="text-center text-sm text-amber-500">你可以拖拽任意的字符串到这个网站作为 TAG！</div><span>数据为空, 你可以</span><ol class=" px-4 text-left"><li>1. 直接拖拽魔咒文本到这里</li><li>2. 在魔导绪论拖拽一键复制按钮到这里</li></ol></div>',12),$e=l('<div class="font-icon btn bg-rose-700 text-gray-200">x</div>',2),me=l('<div class="flex justify-between"><span>这个区块貌似出现了 BUG，如果重新加载不行，就删除吧</span><!#><!/><div class="btn bg-sky-700">重新加载</div></div>',8),xe=l('<header class="flex cursor-pointer justify-between"><div class="flex cursor-pointer items-center gap-2" title="点我修改标题"><span></span><span class="font-icon">📝</span></div><div class="flex "></div></header>',10),fe=l('<nav class="my-1 w-full bg-gray-700" style="height:1px"></nav>',2),he=l('<span class="cursor-pointer  text-gray-500"><!#><!/><span class="font-icon float-right whitespace-nowrap ">📝</span></span>',6),_e=l('<div class="my-2 flex flex-nowrap gap-4 overflow-y-auto overflow-x-visible"></div>',2),Fe=l('<div class="flex justify-between py-1 text-xs text-gray-600"><nav></nav><nav></nav></div>',6),be=l('<div class=" rounded-md bg-slate-800 p-4 shadow-lg shadow-gray-900"><!#><!/><!#><!/></div>',6),ve=l("<div> 加载中</div>",2),we=l('<span class="text-gray-500">拖拽图片到这里添加 Demo</span>',2),Be=()=>{const{hidImage:i,IndexList:a,store:t,DeleteMagic:g,ChangeMagic:u,AddDemoImage:m,DeleteImage:d}=C.getApp("notebook");return(()=>{const $=n(pe);return c($,s(j,{get each(){return a()},get fallback(){return n(ge)},children:(r,_)=>{const e=W(()=>t.getItem(r).then(o=>o)),y=s(T,{detect:{MAGIC_IMAGE(){A.warn("从魔咒中删除这个图片")}},receive:{MAGIC_IMAGE(o){d(o.origin,o.position).then(()=>{e.refetch(),f.success("删除成功")})}},get children(){const o=n($e);return o.$$click=()=>{confirm(`是否删除${e()?.title}
${e()?.tags}`)&&g(e()?.id??a()[_()]).then(()=>f.success("删除成功"))},w(),o}});return s(T,{detect:{PURE_TAGS(){A.success("松手，修改魔咒文本")},extra(o){o.types.includes("Files")&&A.success("添加图片到这个魔咒")}},receive:{PURE_TAGS(o){u({...e(),tags:o}).then(()=>e.refetch()).then(()=>{f.success("修改魔咒成功")})},extra(o,B){Promise.all([...B.files].filter(h=>h.type.startsWith("image/")).map(h=>m(h,e()))).then(h=>{h.length&&e.refetch()})}},get children(){const o=n(be),B=o.firstChild,[h,I]=v(B.nextSibling),M=h.nextSibling,[P,G]=v(M.nextSibling);return c(o,s(D,{get when(){return e()===null},get children(){const p=n(me),x=p.firstChild,b=x.nextSibling,[E,F]=v(b.nextSibling),S=E.nextSibling;return c(p,y,E,F),S.$$click=()=>{f.success("重新加载开始"),e.refetch()},w(),p}}),h,I),c(o,s(D,{get when(){return e.isReady()},get fallback(){return n(ve)},get children(){return[(()=>{const p=n(xe),x=p.firstChild,b=x.firstChild,E=x.nextSibling;return x.$$click=()=>{const F=prompt("请输入这个魔咒的名称",e().title);F&&u({...e(),title:F}).then(S=>e.refetch())},c(b,()=>e().title),c(E,y),w(),p})(),n(fe),(()=>{const p=n(he),x=p.firstChild,[b,E]=v(x.nextSibling),F=b.nextSibling;return c(p,()=>e().description||"没有描述信息哦",b,E),F.$$click=S=>{S.stopPropagation();const N=prompt("请修改描述",e().description);N&&u({...e(),description:N}).then(()=>e.refetch())},w(),p})(),s(re,{data:e}),s(D,{get when(){return!i()},get children(){const p=n(_e);return c(p,s(j,{get each(){return e().demos},get fallback(){return n(we)},children:x=>s(de,{get data(){return e()},id:x})})),p}}),(()=>{const p=n(Fe),x=p.firstChild,b=x.nextSibling;return c(x,()=>new Date(e().create_time).toLocaleDateString()),c(b,()=>new Date(e().last_update).toLocaleDateString()),p})()]}}),P,G),o}})}})),$})()};k(["click"]);const Ee=l('<main class="m-auto mx-auto my-4 w-full max-w-sm rounded-lg border border-slate-600 p-4"><header class="my-4 text-lg text-white">数据存储系统</header><!#><!/></main>',6),Ce=l('<div class="btn text-sm text-white"></div>',2),Ae=l('<div class="my-2 rounded bg-green-800 p-2 text-sm text-white">您可以在这里备份您的魔咒笔记。文件备份将保留您的魔咒文本，而图片数据由于太大，所以需要分片单独下载。</div>',2),ye=l('<section class="flex flex-col gap-4"><div class="btn"><span class="font-icon">📷</span>下载魔咒文件</div><div class="btn"><span class="font-icon">📷</span>下载所有图片</div></section>',10),ke=l('<div class="my-2 rounded bg-blue-800 p-2 text-sm text-white">导入您导出的文件, 所有导入文件都将会添加到现有数据中来</div>',2),H=l('<span class="font-icon">📷</span>',2),Se=l('<section class="flex flex-col gap-4"><!#><!/><!#><!/></section>',6),De=()=>s(ne,{id:"backup",get children(){const i=n(Ee),a=i.firstChild,t=a.nextSibling,[g,u]=v(t.nextSibling);return c(i,s(Z,{activeId:"导出",get children(){return[s(ee,{children:m=>{const{changeSelected:d,isSelected:$}=q(te);return(()=>{const r=n(Ce);return r.$$click=()=>{d(m,!0)},c(r,m),R(()=>r.classList.toggle("bg-red-600",!!$(m))),w(),r})()}}),s(Ie,{}),s(Me,{})]}}),g,u),i}}),Ie=()=>{const{ExportText:i,ExportImage:a}=C.getApp("notebook");return s(X,{id:"导出",get children(){return[n(Ae),(()=>{const t=n(ye),g=t.firstChild,u=g.nextSibling;return g.$$click=async()=>{const m=await i();L.saveAs(m,`魔导绪论导出-${Date.now()}.json`)},u.$$click=async()=>{if(confirm("将会进行打包分包下载图片")){const d=Date.now();await a(async($,r)=>{L.saveAs($,`魔导绪论图片导出-${d}-${r}.zip`)})}},w(),t})()]}})},Me=()=>{const{ImportText:i,ImportImage:a}=C.getApp("notebook");return s(X,{id:"导入",get children(){return[n(ke),(()=>{const t=n(Se),g=t.firstChild,[u,m]=v(g.nextSibling),d=u.nextSibling,[$,r]=v(d.nextSibling);return c(t,s(z,{accept:"application/json",onUpload:_=>{i(_[0]).then(()=>{f.success("导入成功, 刷新页面后显示")})},get children(){return[n(H),"导入魔咒文件"]}}),u,m),c(t,s(z,{multiple:!0,onUpload:async _=>{f.success("开始进行导入，请稍等");for(const e of _)await a(e),f.success("成功导入分片");f.success("全部导入完成，请刷新页面")},get children(){return[n(H),"导入所有图片"]}}),$,r),t})()]}})};k(["click"]);const Pe=l('<main class="font-global relative m-auto flex h-screen w-full max-w-6xl flex-col  items-center   overflow-y-auto overflow-x-visible text-gray-400"><header class="sticky top-2 z-40  w-full max-w-6xl "><section class=" my-4  mx-2 flex items-center divide-x-2 divide-gray-700 rounded-md bg-slate-800 p-2 shadow-lg shadow-gray-900"><header class=" pl-2 pr-4 text-xl">魔咒记忆器</header><div class="flex flex-1 items-center justify-end "><div class="font-icon h-8 w-8 cursor-pointer rounded-md p-1 text-center transition-colors hover:bg-slate-700">✒️</div><div class="font-icon h-8 w-8 cursor-pointer rounded-md p-1 text-center transition-colors hover:bg-slate-700">🔃</div><div class="font-icon h-8 w-8 cursor-pointer rounded-md p-1 text-center transition-colors hover:bg-slate-700"></div><div class="h-fit rounded-md p-1 text-xs hover:bg-slate-700">📝 <!#><!/></div></div></section></header><section class="flex w-full flex-col  overflow-x-visible px-2"></section><!#><!/></main>',24),Ge=J(),et=()=>{const{visibleId:i,registerPanel:a}=C.getApp("side-app");a("backup",De);const{t}=K(),{hidImage:g,addMagic:u,IndexList:m}=C.getApp("notebook");return s(Ge.Provider,{value:{hidImage:g},get children(){return s(T,{detect:{PURE_TAGS(){A.success(t("Notebook.hint.PURE_TAGS"))},extra(d){[...d.types.values()].some($=>$.startsWith("text"))&&A.success(t("Notebook.hint.text"))}},multi:!1,receive:{PURE_TAGS(d){return u(d),f.success("创建魔咒成功"),!0},extra(d,$){const r=$.getData("text");r&&confirm(`这是一个魔咒吗？
 ${r}`)&&(u(r),f.success("创建魔咒成功"))}},get children(){const d=n(Pe),$=d.firstChild,r=$.firstChild,_=r.firstChild,e=_.nextSibling,y=e.firstChild,o=y.nextSibling,B=o.nextSibling,h=B.nextSibling,I=h.firstChild,M=I.nextSibling,[P,G]=v(M.nextSibling),p=$.nextSibling,x=p.nextSibling,[b,E]=v(x.nextSibling);return y.$$click=()=>{const F=prompt("请输入需要添加的魔咒");F&&(u(F),f.success("创建魔咒成功"))},o.$$click=()=>i("backup"),B.$$click=()=>g(F=>!F),c(B,()=>g()?"🪟":"📷"),c(h,()=>m().length,P,G),c(p,s(Be,{})),c(d,s(Q,{}),b,E),R(()=>U(h,"title",`你有 ${m().length} 份魔咒`)),w(),d}})}})};k(["click"]);export{et as Notebook};
