import{A as Me,f as _,U as Ee,d as Ie}from"./index.4f2c4b12.js";import{G as K,E as Le}from"./GlobalData.4e554cac.js";import{c as he,a as Ce,b as Re,d as I}from"./web.9ee1b91f.js";import{l as Be,u as De}from"./useIndexedDB.84c7bc09.js";import{i as je,a as Ge,b as Ue}from"./TagsConvertor.b3f5406f.js";import{r as O,i as G,b as z,f as Fe,S as Z,a as Ne,p as B}from"./index.b92d985b.js";import{g as R,i as He,L as q,M as C,a as be,t as S,e as Ke}from"./memoize.49269b7f.js";import{i as _e,a as $,b as ze,c as qe,d as ye,e as We,f as Ae,t as me,h as Ye,g as Je}from"./hasIn.294499a0.js";import{N as Q}from"./notice.940364ec.js";import{u as Ze}from"./index.c584f020.js";import"./index.7d109aa8.js";import{l as Qe}from"./localSync.c4f5a119.js";import{T as Xe}from"./TagAPI.b55cf1a1.js";import"./preload-helper.101896b7.js";import"./_commonjsHelpers.edff4021.js";import"./md5.0fe766d4.js";/* empty css                       */import"./cloud.6055f26b.js";import"https://cdn.jsdelivr.net/npm/leancloud-storage@4.14.0/dist/av-min.js";var Ve=R(O,"WeakMap");const U=Ve;function ke(){}function et(e,t,n,r){for(var a=e.length,s=n+(r?1:-1);r?s--:++s<a;)if(t(e[s],s,e))return s;return-1}function tt(e){return e!==e}function nt(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}function rt(e,t,n){return t===t?nt(e,t,n):et(e,tt,n)}function st(e,t){var n=e==null?0:e.length;return!!n&&rt(e,t,0)>-1}function at(e){return e!=null&&_e(e.length)&&!He(e)}var it=Object.prototype;function ot(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||it;return e===n}function ft(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function ut(){return!1}var ve=typeof exports=="object"&&exports&&!exports.nodeType&&exports,X=ve&&typeof module=="object"&&module&&!module.nodeType&&module,lt=X&&X.exports===ve,V=lt?O.Buffer:void 0,ct=V?V.isBuffer:void 0,gt=ct||ut;const F=gt;var pt="[object Arguments]",dt="[object Array]",ht="[object Boolean]",bt="[object Date]",_t="[object Error]",yt="[object Function]",At="[object Map]",mt="[object Number]",vt="[object Object]",Tt="[object RegExp]",wt="[object Set]",Ot="[object String]",St="[object WeakMap]",Pt="[object ArrayBuffer]",$t="[object DataView]",xt="[object Float32Array]",Mt="[object Float64Array]",Et="[object Int8Array]",It="[object Int16Array]",Lt="[object Int32Array]",Ct="[object Uint8Array]",Rt="[object Uint8ClampedArray]",Bt="[object Uint16Array]",Dt="[object Uint32Array]",p={};p[xt]=p[Mt]=p[Et]=p[It]=p[Lt]=p[Ct]=p[Rt]=p[Bt]=p[Dt]=!0;p[pt]=p[dt]=p[Pt]=p[ht]=p[$t]=p[bt]=p[_t]=p[yt]=p[At]=p[mt]=p[vt]=p[Tt]=p[wt]=p[Ot]=p[St]=!1;function jt(e){return G(e)&&_e(e.length)&&!!p[z(e)]}function Gt(e){return function(t){return e(t)}}var Te=typeof exports=="object"&&exports&&!exports.nodeType&&exports,P=Te&&typeof module=="object"&&module&&!module.nodeType&&module,Ut=P&&P.exports===Te,D=Ut&&Fe.process,Ft=function(){try{var e=P&&P.require&&P.require("util").types;return e||D&&D.binding&&D.binding("util")}catch{}}();const k=Ft;var ee=k&&k.isTypedArray,Nt=ee?Gt(ee):jt;const we=Nt;var Ht=Object.prototype,Kt=Ht.hasOwnProperty;function zt(e,t){var n=$(e),r=!n&&ze(e),a=!n&&!r&&F(e),s=!n&&!r&&!a&&we(e),u=n||r||a||s,i=u?ft(e.length,String):[],o=i.length;for(var f in e)(t||Kt.call(e,f))&&!(u&&(f=="length"||a&&(f=="offset"||f=="parent")||s&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||qe(f,o)))&&i.push(f);return i}function qt(e,t){return function(n){return e(t(n))}}var Wt=qt(Object.keys,Object);const Yt=Wt;var Jt=Object.prototype,Zt=Jt.hasOwnProperty;function Qt(e){if(!ot(e))return Yt(e);var t=[];for(var n in Object(e))Zt.call(e,n)&&n!="constructor"&&t.push(n);return t}function Oe(e){return at(e)?zt(e):Qt(e)}function Xt(e,t,n){var r=e==null?void 0:ye(e,t);return r===void 0?n:r}function Vt(){this.__data__=new q,this.size=0}function kt(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function en(e){return this.__data__.get(e)}function tn(e){return this.__data__.has(e)}var nn=200;function rn(e,t){var n=this.__data__;if(n instanceof q){var r=n.__data__;if(!C||r.length<nn-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new be(r)}return n.set(e,t),this.size=n.size,this}function y(e){var t=this.__data__=new q(e);this.size=t.size}y.prototype.clear=Vt;y.prototype.delete=kt;y.prototype.get=en;y.prototype.has=tn;y.prototype.set=rn;function sn(e,t){for(var n=-1,r=e==null?0:e.length,a=0,s=[];++n<r;){var u=e[n];t(u,n,e)&&(s[a++]=u)}return s}function an(){return[]}var on=Object.prototype,fn=on.propertyIsEnumerable,te=Object.getOwnPropertySymbols,un=te?function(e){return e==null?[]:(e=Object(e),sn(te(e),function(t){return fn.call(e,t)}))}:an;const ln=un;function cn(e,t,n){var r=t(e);return $(e)?r:We(r,n(e))}function ne(e){return cn(e,Oe,ln)}var gn=R(O,"DataView");const N=gn;var pn=R(O,"Promise");const H=pn;var dn=R(O,"Set");const w=dn;var re="[object Map]",hn="[object Object]",se="[object Promise]",ae="[object Set]",ie="[object WeakMap]",oe="[object DataView]",bn=S(N),_n=S(C),yn=S(H),An=S(w),mn=S(U),T=z;(N&&T(new N(new ArrayBuffer(1)))!=oe||C&&T(new C)!=re||H&&T(H.resolve())!=se||w&&T(new w)!=ae||U&&T(new U)!=ie)&&(T=function(e){var t=z(e),n=t==hn?e.constructor:void 0,r=n?S(n):"";if(r)switch(r){case bn:return oe;case _n:return re;case yn:return se;case An:return ae;case mn:return ie}return t});const fe=T;var vn=O.Uint8Array;const ue=vn;var Tn="__lodash_hash_undefined__";function wn(e){return this.__data__.set(e,Tn),this}function On(e){return this.__data__.has(e)}function x(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new be;++t<n;)this.add(e[t])}x.prototype.add=x.prototype.push=wn;x.prototype.has=On;function Sn(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Se(e,t){return e.has(t)}var Pn=1,$n=2;function Pe(e,t,n,r,a,s){var u=n&Pn,i=e.length,o=t.length;if(i!=o&&!(u&&o>i))return!1;var f=s.get(e),l=s.get(t);if(f&&l)return f==t&&l==e;var c=-1,g=!0,d=n&$n?new x:void 0;for(s.set(e,t),s.set(t,e);++c<i;){var h=e[c],b=t[c];if(r)var A=u?r(b,h,c,t,e,s):r(h,b,c,e,t,s);if(A!==void 0){if(A)continue;g=!1;break}if(d){if(!Sn(t,function(m,v){if(!Se(d,v)&&(h===m||a(h,m,n,r,s)))return d.push(v)})){g=!1;break}}else if(!(h===b||a(h,b,n,r,s))){g=!1;break}}return s.delete(e),s.delete(t),g}function xn(e){var t=-1,n=Array(e.size);return e.forEach(function(r,a){n[++t]=[a,r]}),n}function W(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var Mn=1,En=2,In="[object Boolean]",Ln="[object Date]",Cn="[object Error]",Rn="[object Map]",Bn="[object Number]",Dn="[object RegExp]",jn="[object Set]",Gn="[object String]",Un="[object Symbol]",Fn="[object ArrayBuffer]",Nn="[object DataView]",le=Z?Z.prototype:void 0,j=le?le.valueOf:void 0;function Hn(e,t,n,r,a,s,u){switch(n){case Nn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Fn:return!(e.byteLength!=t.byteLength||!s(new ue(e),new ue(t)));case In:case Ln:case Bn:return Ke(+e,+t);case Cn:return e.name==t.name&&e.message==t.message;case Dn:case Gn:return e==t+"";case Rn:var i=xn;case jn:var o=r&Mn;if(i||(i=W),e.size!=t.size&&!o)return!1;var f=u.get(e);if(f)return f==t;r|=En,u.set(e,t);var l=Pe(i(e),i(t),r,a,s,u);return u.delete(e),l;case Un:if(j)return j.call(e)==j.call(t)}return!1}var Kn=1,zn=Object.prototype,qn=zn.hasOwnProperty;function Wn(e,t,n,r,a,s){var u=n&Kn,i=ne(e),o=i.length,f=ne(t),l=f.length;if(o!=l&&!u)return!1;for(var c=o;c--;){var g=i[c];if(!(u?g in t:qn.call(t,g)))return!1}var d=s.get(e),h=s.get(t);if(d&&h)return d==t&&h==e;var b=!0;s.set(e,t),s.set(t,e);for(var A=u;++c<o;){g=i[c];var m=e[g],v=t[g];if(r)var J=u?r(v,m,g,t,e,s):r(m,v,g,e,t,s);if(!(J===void 0?m===v||a(m,v,n,r,s):J)){b=!1;break}A||(A=g=="constructor")}if(b&&!A){var M=e.constructor,E=t.constructor;M!=E&&"constructor"in e&&"constructor"in t&&!(typeof M=="function"&&M instanceof M&&typeof E=="function"&&E instanceof E)&&(b=!1)}return s.delete(e),s.delete(t),b}var Yn=1,ce="[object Arguments]",ge="[object Array]",L="[object Object]",Jn=Object.prototype,pe=Jn.hasOwnProperty;function Zn(e,t,n,r,a,s){var u=$(e),i=$(t),o=u?ge:fe(e),f=i?ge:fe(t);o=o==ce?L:o,f=f==ce?L:f;var l=o==L,c=f==L,g=o==f;if(g&&F(e)){if(!F(t))return!1;u=!0,l=!1}if(g&&!l)return s||(s=new y),u||we(e)?Pe(e,t,n,r,a,s):Hn(e,t,o,n,r,a,s);if(!(n&Yn)){var d=l&&pe.call(e,"__wrapped__"),h=c&&pe.call(t,"__wrapped__");if(d||h){var b=d?e.value():e,A=h?t.value():t;return s||(s=new y),a(b,A,n,r,s)}}return g?(s||(s=new y),Wn(e,t,n,r,a,s)):!1}function Y(e,t,n,r,a){return e===t?!0:e==null||t==null||!G(e)&&!G(t)?e!==e&&t!==t:Zn(e,t,n,r,Y,a)}var Qn=1,Xn=2;function Vn(e,t,n,r){var a=n.length,s=a,u=!r;if(e==null)return!s;for(e=Object(e);a--;){var i=n[a];if(u&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++a<s;){i=n[a];var o=i[0],f=e[o],l=i[1];if(u&&i[2]){if(f===void 0&&!(o in e))return!1}else{var c=new y;if(r)var g=r(f,l,o,e,t,c);if(!(g===void 0?Y(l,f,Qn|Xn,r,c):g))return!1}}return!0}function $e(e){return e===e&&!Ne(e)}function kn(e){for(var t=Oe(e),n=t.length;n--;){var r=t[n],a=e[r];t[n]=[r,a,$e(a)]}return t}function xe(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function er(e){var t=kn(e);return t.length==1&&t[0][2]?xe(t[0][0],t[0][1]):function(n){return n===e||Vn(n,e,t)}}var tr=1,nr=2;function rr(e,t){return Ae(e)&&$e(t)?xe(me(e),t):function(n){var r=Xt(n,e);return r===void 0&&r===t?Ye(n,e):Y(t,r,tr|nr)}}function sr(e){return function(t){return t?.[e]}}function ar(e){return function(t){return ye(t,e)}}function ir(e){return Ae(e)?sr(me(e)):ar(e)}function or(e){return typeof e=="function"?e:e==null?Je:typeof e=="object"?$(e)?rr(e[0],e[1]):er(e):ir(e)}function fr(e,t,n){for(var r=-1,a=e==null?0:e.length;++r<a;)if(n(t,e[r]))return!0;return!1}var ur=1/0,lr=w&&1/W(new w([,-0]))[1]==ur?function(e){return new w(e)}:ke;const cr=lr;var gr=200;function pr(e,t,n){var r=-1,a=st,s=e.length,u=!0,i=[],o=i;if(n)u=!1,a=fr;else if(s>=gr){var f=t?null:cr(e);if(f)return W(f);u=!1,a=Se,o=new x}else o=t?[]:i;e:for(;++r<s;){var l=e[r],c=t?t(l):l;if(l=n||l!==0?l:0,u&&c===c){for(var g=o.length;g--;)if(o[g]===c)continue e;t&&o.push(c),i.push(l)}else a(o,c,n)||(o!==i&&o.push(c),i.push(l))}return i}function dr(e,t){return e&&e.length?pr(e,or(t)):[]}const hr=e=>({recover(){Object.entries(e).map(([t,n])=>{const r=localStorage.getItem(t);r!==null&&n(JSON.parse(r))})},tracking(){Object.entries(e).map(([t,n])=>{Me(()=>{console.log("存储设置"),localStorage.setItem(t,JSON.stringify(n()))},[n])})}}),br=(e,t,n)=>(Promise.resolve(n.getItem(t)).then(r=>{r&&e(()=>r)}),he(()=>{console.log("写入 IndexDB ",t),n.setItem(t,e())}),e),_r=Be.createInstance({name:"user-data"}),yr=()=>({backgroundImage:br(_(""),"background-image",_r)}),Ar=e=>Object.fromEntries(Object.entries(e).map(([t,n])=>[t,_(n)])),mr=()=>{const t={...Ar({tag_version:"2.1.3",showClassify:!0,nonBreakLine:!1,forceEN:!1,emphasizeAddMode:!1,emphasizeSubMode:!1,deleteMode:!1,emphasizeSymbol:"()",enMode:!0,tagsPerPage:500,r18Mode:!1,showCount:!0,username:"",searchNumberLimit:1e3,webviewURL:"",MaxEmphasize:10,defaultFont:!1,iconBtn:!1,showLangInLine1:!1}),...yr()},{recover:n,tracking:r}=hr(t);n(),r();const a={...t,changeTagMode(s,u){return[t.emphasizeAddMode,t.emphasizeSubMode,t.deleteMode].forEach(i=>{i===s?s(u):i(!1)})}};return K.register("data",a),a},vr=()=>{const e=_(!je()),t=_(location.hash.slice(1));he(()=>{location.hash="#"+t()});const n=Ce(t),r=_(new Map,{equals:!1}),a={sideAppMode:e,visibleId:t,extraPanels:r,isPanelVisible:n,isOpened(){const s=t();return typeof s=="string"&&s},registerPanel:(s,u)=>{r(i=>i.set(s,u))}};return K.register("side-app",a),a},Tr=(e,t)=>{let n=e>0?e-1:t.length+e;return n>=t.length-1&&(n=t.length-1),n<0&&(n=0),n},de=(e,t)=>{const n=Tr(e,t);return{_current:t[n],_before:t.slice(0,n),_after:t.slice(n+1)}};function wr(e,t=0){const n=e,r=_([]),a=_([]),s=()=>I(()=>{a([]),r([])}),u=(f=1)=>{if(a.length===0)return;const{_before:l,_current:c,_after:g}=de(f,a());I(()=>{n(()=>c),r(d=>[...d,n(),...l]),a(g)})},i=(f=-1)=>{if(r.length===0)return;const{_before:l,_current:c,_after:g}=de(f,r());I(()=>{n(()=>c),r(l),a(d=>[...g,c,...d])})},o=f=>{if(f!==0){if(f>0)return u(f);i(f)}};return{now:Re(()=>n()),past:r,future:a,go:o,addToHistory(f){const l=[...r(),n()];t>0&&l.length>t&&l.splice(0,1),I(()=>{n(()=>f),a([]),r(l)})},back:()=>o(-1),forward:()=>o(1),reset:s}}const Or=(e,t)=>{const[n,r]=[e,t].map(i=>i.reduce((o,f)=>(Ge(f)?o.push([]):o[o.length-1].push(f),o),[[]]).filter(o=>o.length));let a=Math.max(n.length,r.length);const s=[...Array(a).keys()].map(i=>{const o=n[i]??[],f=r[i]??[];return o.length&&f.length?Sr(o,f):o.length?o:f}),u=s.flatMap((i,o)=>o===s.length-1?i:[...i,{...Ue}]);return dr(u,i=>i.en===`
`?Math.random().toString()+Math.random().toString():i.en)},Sr=(e,t)=>{const n=[];for(;t.length||e.length;)n.length&&n.push(t.shift()),e.length&&n.push(e.shift());return n.filter(Boolean)},Pr=()=>{const e=_([]),t=e.reflux(e(),n=>n.filter((r,a)=>r&&(r.text===`
`||n.findIndex(s=>s.en===r.en)===a)));return Object.assign(function(){return arguments.length===0?e():t(...arguments)},{[Ie]:"atom"})};function $r(e){console.log("重绘");const t=_([]),n=Pr(),r=wr(n),a=()=>{r.back(),B.success("撤销成功")},s=()=>{r.forward(),B.success("恢复成功")},u=_(""),i=Ee(()=>Xe.searchTags(u(),e.r18Mode()),{initValue:[],immediately:!1,deps:[u]});Qe(i,"the_search_data_of_main_page");const o={lists:t,result:i,searchText:u,usersCollection:n,TagsHistory:r,redo:s,undo:a,injectTags:(f,l,c=!1,g=!1,d=n)=>{const{t:h}=Ze();if(c){const b=Or(l,f);d(b),B.success(h("publicPanel.hint.CombineSuccess"))}else g?(d(b=>[...b,...l]),Q.success(h("publicPanel.hint.CopySuccess"))):(d(l),Q.success(h("publicPanel.hint.CopySuccess")))}};return K.register("tag-control",o),o}const xr=Le("notebook",()=>({hidImage:_(!1),...De()})),Jr=e=>{vr();const t=mr();return $r(t),xr(),e.children};export{Jr as GlobalInit};
