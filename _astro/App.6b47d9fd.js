import{e as g,g as S,i as p,b as Q,h as P,s as O,P as W,t as w,j as L,r as I,f as b,d as K,S as T,c as J,u as Y,v as X,k as Z,F as U}from"./web.9ee1b91f.js";import{x as j,f as C,i as ee,l as te,A as V,W as q}from"./index.4f2c4b12.js";import{F as ne,u as le}from"./FileSaver.min.1c20ed5c.js";import{A as re}from"./index.79db8632.js";import{G as _,E as ie}from"./GlobalData.4e554cac.js";import{v as se,I as ae,g as ce,X as oe}from"./index.b92d985b.js";import{a as de,A as ge,S as ue}from"./ScrollLoading.e835eccb.js";import{N as fe}from"./notice.940364ec.js";import{A as pe}from"./cloud.6055f26b.js";/* empty css                       */import"https://cdn.jsdelivr.net/npm/viewerjs@1.11.2/dist/viewer.esm.min.js";import"./_commonjsHelpers.edff4021.js";import"https://cdn.jsdelivr.net/npm/leancloud-storage@4.14.0/dist/av-min.js";const me=w('<div class=" brightness-40 pointer-events-none fixed top-0 left-0 -z-10 h-screen w-screen opacity-40"></div>',2),he=w('<img loading="lazy" class="h-full w-full  object-cover " alt="">',1),xe=t=>{const s=j(()=>t.image);return g(W,{get mount(){return document.body},get children(){const e=S(me);return p(e,(()=>{const n=Q(()=>!!s());return()=>n()&&(()=>{const l=S(he);return l.addEventListener("error",()=>s("")),l.style.setProperty("min-height","100%"),l.style.setProperty("min-width","100%"),P(()=>O(l,"src",s())),l})()})()),e}})},$e=w('<img loading="lazy" class="w-full overflow-hidden rounded-lg object-cover  " alt="">',1),H=t=>{const s=C(!1);return(()=>{const e=S($e);return e.addEventListener("error",()=>s(!0)),e.$$click=()=>{t.onClick&&t.onClick(t.src)},e.addEventListener("load",n=>{t.onReady&&t.onReady(s()?t.fallbackSrc:t.src)}),O(e,"draggable",!1),e.style.setProperty("min-height","6rem"),P(n=>{const l=s()?t.fallbackSrc:t.src,r=t.aspect;return l!==n._v$&&O(e,"src",n._v$=l),r!==n._v$2&&e.style.setProperty("aspect-ratio",n._v$2=r),n},{_v$:void 0,_v$2:void 0}),I(),e})()};L(["click"]);const ve=w('<div class="single-pic relative  w-full  cursor-pointer  rounded-md  shadow-lg transition-transform  duration-500 "><!#><!/><div class="absolute top-2 right-2 h-fit cursor-pointer rounded-xl bg-lime-600  px-1  text-slate-200 line-clamp-1"></div><div class="title-item  absolute  bottom-0 left-0 flex w-full  flex-col  items-center justify-between gap-1 px-4 py-2 text-slate-700  opacity-0 sm:flex-row"><div class=" w-full rounded-lg bg-slate-200  px-2  text-center line-clamp-1 "></div><nav class="flex gap-2"><div class="font-icon h-7 w-7 cursor-pointer rounded-full bg-lime-500  text-center text-lg  text-white">ğŸ“·</div><div class="font-icon h-7 w-7 cursor-pointer rounded-full bg-lime-500  text-center text-lg  text-white">ğŸ“¥</div></nav></div></div>',16),be=t=>{const{index:s,data:e}=t,{visibleId:n}=_.getApp("side-app"),{ShowingPicture:l,getViewer:r,searchText:o,ShowingPictureURL:a}=_.getApp("gallery"),{backgroundImage:u}=_.getApp("data");let i=e.tags;try{const d=JSON.parse(e.other??"{}");i=new Map(d).get("Description")||e.tags}catch{}return g(re,{send:(d,m)=>(d("INPUT_MAGIC",i),m.setData("text",i)),get children(){const d=S(ve),m=d.firstChild,[x,v]=b(m.nextSibling),h=x.nextSibling,c=h.nextSibling,f=c.firstChild,$=f.nextSibling,k=$.firstChild,A=k.nextSibling;return p(d,g(H,{get src(){return e.image+"?q=50"},get aspect(){return e.size.replace("x","/")},get fallbackSrc(){return e.image},onClick:y=>{K(()=>{l(e),n("detail"),u(y),a(y.replace("q=50",""))})}}),x,v),h.$$click=()=>{o(`username:${e.username}`)},p(h,()=>e.username),p(f,()=>e.description),k.$$click=()=>r().view(s),A.$$click=async()=>{const y=await fetch(e.image).then(E=>E.blob());ne.saveAs(y,e.description+"-"+e.username+".png")},I(),d}})};L(["click"]);const _e=w("<div>æ²¡æœ‰æ•°æ®å“¦</div>",2),Se=()=>{const{showingData:t}=_.getApp("gallery"),{size:s}=ae(),e=j(()=>{switch(s()){case"md":return 3;case"lg":return 3;case"xl":return 4;case"2xl":return 4;default:return 2}});return{images:j(()=>{const l=t().flat().filter(i=>i);let r=[...Array(e()).keys()].map(i=>[]),o=Array(e()).fill(0);l.forEach(i=>{const[d,m]=i.size.split("x"),x=parseInt(m)/parseInt(d),v=Math.min(...o),h=o.indexOf(v);o[h]+=x,r[h].push(i)});let a=Math.max(...r.map(i=>i.length)),u=[];for(let i=0;i<a;i++)u.push(...r.map(d=>d.shift()));return u}),columns:e}},we=()=>{const{images:t,columns:s}=Se();return g(se,{items:t,column:s,class:"gap-2 sm:gap-4",colClass:"gap-2 sm:gap-4",fallback:()=>S(_e),children:(e,n)=>e?g(be,{data:e,get index(){return n()}}):null})},ye=w('<section class="z-10 flex h-full flex-col items-center gap-4 overflow-auto break-words  p-2 sm:p-1"><nav class="flex h-[30vh]  cursor-pointer flex-col items-center justify-center sm:h-full"><!#><!/><div class="btn ">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</div><header class="my-2 w-full rounded-lg bg-lime-600 py-2 px-4 text-center text-2xl font-bold text-slate-200 line-clamp-1"></header></nav><div class="flex w-full  flex-none flex-col gap-4  text-slate-200 sm:p-4"><nav class="flex justify-between  bg-emerald-700 px-2"><div>ä½œè€…: <!#><!/></div><div>ç§å­å·ç : <!#><!/></div></nav><!#><!/></div></section>',24),ke=()=>{const{ShowingPicture:t,getViewer:s,replaceImages:e,ShowingPictureURL:n}=_.getApp("gallery");_.getApp("side-app");const l=j(()=>{if(!t())return null;const r=Object.fromEntries(JSON.parse(t()?.other||"[]"));return r.Description||(r.Description=t().tags),r});return g(T,{get when(){return t()},get children(){const r=S(ye),o=r.firstChild,a=o.firstChild,[u,i]=b(a.nextSibling),d=u.nextSibling,m=d.nextSibling,x=o.nextSibling,v=x.firstChild,h=v.firstChild,c=h.firstChild,f=c.nextSibling,[$,k]=b(f.nextSibling),A=h.nextSibling,y=A.firstChild,E=y.nextSibling,[z,B]=b(E.nextSibling),R=v.nextSibling,[F,M]=b(R.nextSibling);return o.$$click=()=>{const{description:N}=t(),D=n();e([{alt:N,src:D,origin:D}]),s().view(0)},p(o,g(H,{get src(){return t().image+"?q=50"},get aspect(){return t().size.replace("x","/")},get fallbackSrc(){return t().image}}),u,i),p(m,()=>t().description),p(h,()=>t().username,$,k),p(A,()=>t().seed,z,B),p(x,g(T,{get when(){return l()},get children(){return g(de,{data:l})}}),F,M),I(),r}})};L(["click"]);const Ce=w('<div class="flex overflow-hidden rounded-lg bg-slate-700 "><input class="min-w-[4em] appearance-none bg-slate-700 px-4 text-sm outline-none transition-all sm:w-28  " placeholder="æœç´¢æ ‡é¢˜" type="search"></div>',3),Ae=t=>{const{clearAndResearch:s,searchText:e}=_.getApp("gallery"),n=ce(async()=>{s()},1e3);let l=e();J(()=>{l!==e()&&(l=e(),n())});let r;return(()=>{const o=S(Ce),a=o.firstChild;a.addEventListener("blur",()=>{t.onblur&&t.onblur()}),a.$$input=()=>{e(r.value)},a.addEventListener("focus",()=>t.onfocus&&t.onfocus());const u=r;return typeof u=="function"?Y(u,a):r=a,P(i=>X(a,{"sm:min-w-[20em]":!!e()},i)),P(()=>a.value=e()),I(),o})()};L(["input"]);const Ie=ie("gallery",()=>{const{replaceImages:t,getViewer:s}=le(),e=new URLSearchParams(location.search).get("r18"),n=C(!1),l=C(""),r=ee({multi:!1}),o=()=>{new pe.Query("gallery_category").find().then(c=>{c.forEach(f=>r.register(f.toJSON().categories))})},{dataSlices:a,next:u,currentIndex:i,resetStack:d}=te(async(c,f)=>n()?[]:ge.getData(c,!!e,$=>{l()&&$.contains("description",l()),r.activeIds().size>0&&$.containsAll("categories",[...r.activeIds()])}).then($=>(f(c+2),$.length===0&&n(!0),$)),{});let m="";V(()=>{const c=[...r.activeIds()];m!==c.join(",")&&(d(),m=c.join(","))},[r.activeIds]),J(()=>{t(a().flatMap(c=>c.map(f=>({alt:f.description,src:f.image+"?q=50",origin:f.image}))))});const x=async(c,f=!1)=>(f&&d(),u());V(c=>c===""&&x(0,!0),[l]);const v=C(null),h=C(null);return{ShowingPicture:v,ShowingPictureURL:h,page:i,end:n,changePage:q(async c=>{if(!n())return x()}),clearAndResearch:q(async()=>x(0,!0)),searchText:l,showingData:a,getViewer:s,categories:r,updateCate:o,visibleCate:C(!1),replaceImages:t}}),Ee=w('<div class="btn text-xs"></div>',2),Pe=w('<aside class="mb-2 flex flex-wrap gap-2 rounded-xl bg-slate-800 p-2 "><!#><!/><!#><!/></aside>',6),Le=w('<div class="font-icon cursor-pointer px-2">ğŸ”</div>',2),Re=w('<main class="font-global scroll-none flex h-screen w-full  flex-col overflow-auto  p-4 text-gray-200 sm:p-2"><!#><!/><header class="sticky top-0 z-40 flex w-full flex-col gap-2 pb-2 text-xl"><div class=" flex justify-between rounded-xl bg-slate-600 py-2 px-4 "><span class="flex-none"><a class="pr-2 underline underline-offset-8 transition-colors hover:text-amber-400" href="/" target="_blank">é­”å¯¼ç»ªè®º</a><a class="transition-colors hover:text-amber-400" href="/gallery.html">å›¾åº“</a></span><nav class="flex gap-2"><div class="font-icon cursor-pointer px-2">ğŸ¹</div><!#><!/><div class="font-icon cursor-pointer px-2">â¬†ï¸</div></nav></div></header><!#><!/><!#><!/></main>',26),De=()=>{const{categories:t}=_.getApp("gallery"),s=e=>(()=>{const n=S(Ee);return n.$$click=()=>t.changeSelected(e),p(n,e),P(l=>X(n,{"bg-green-700 text-slate-200":t.isSelected(e)},l)),I(),n})();return(()=>{const e=S(Pe),n=e.firstChild,[l,r]=b(n.nextSibling),o=l.nextSibling,[a,u]=b(o.nextSibling);return p(e,g(U,{get each(){return[...t.activeIds().values()]},children:s}),l,r),p(e,g(U,{get each(){return[...t.allRegistered().values()].filter(i=>!t.isSelected(i))},children:s}),a,u),e})()},Xe=()=>{const{backgroundImage:t}=_.getApp("data"),{registerPanel:s,visibleId:e}=_.getApp("side-app");s("detail",ke),Ie();const n=C(!1),{page:l,changePage:r,updateCate:o,visibleCate:a}=_.getApp("gallery");o();const{ScrollEvent:u}=ue(()=>r(l()+1));return(()=>{const i=S(Re),d=i.firstChild,[m,x]=b(d.nextSibling),v=m.nextSibling,h=v.firstChild,c=h.firstChild,f=c.firstChild,$=c.nextSibling,k=$.firstChild,A=k.nextSibling,[y,E]=b(A.nextSibling),z=y.nextSibling,B=v.nextSibling,[R,F]=b(B.nextSibling),M=R.nextSibling,[N,D]=b(M.nextSibling);return Z(i,"scroll",u),p(i,g(xe,{get image(){return t()}}),m,x),f.$$click=G=>{top&&top!==window&&top.location.origin===location.origin&&(G.preventDefault(),fe.success("æ‚¨å·²ç»åœ¨é­”å¯¼ç»ªè®ºå•¦ğŸ˜„"))},k.$$click=()=>a(G=>!G),p($,g(oe,{disabled:n,animateProps:{extraClass:"animate-duration-300",anime:"scale"},get popup(){return g(Ae,{onfocus:()=>n(!0),onblur:()=>n(!1)})},position:"br",get children(){return S(Le)}}),y,E),z.$$click=()=>e("uploader"),p(i,g(T,{get when(){return a()},get children(){return g(De,{})}}),R,F),p(i,g(we,{}),N,D),I(),i})()};L(["click"]);export{Xe as GalleryRoot};
