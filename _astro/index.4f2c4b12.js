import{D as Q,c as $,o as X,b as q,l as J,d as P,C as Y}from"./web.9ee1b91f.js";var Z=typeof global=="object"&&global&&global.Object===Object&&global;const ee=Z;var te=typeof self=="object"&&self&&self.Object===Object&&self,ne=ee||te||Function("return this")();const G=ne;var re=G.Symbol;const O=re;var V=Object.prototype,oe=V.hasOwnProperty,ie=V.toString,w=O?O.toStringTag:void 0;function ae(e){var t=oe.call(e,w),n=e[w];try{e[w]=void 0;var o=!0}catch{}var r=ie.call(e);return o&&(t?e[w]=n:delete e[w]),r}var ce=Object.prototype,se=ce.toString;function le(e){return se.call(e)}var ue="[object Null]",fe="[object Undefined]",B=O?O.toStringTag:void 0;function de(e){return e==null?e===void 0?fe:ue:B&&B in Object(e)?ae(e):le(e)}function me(e){return e!=null&&typeof e=="object"}var be="[object Symbol]";function he(e){return typeof e=="symbol"||me(e)&&de(e)==be}var pe=/\s/;function ge(e){for(var t=e.length;t--&&pe.test(e.charAt(t)););return t}var ye=/^\s+/;function ve(e){return e&&e.slice(0,ge(e)+1).replace(ye,"")}function A(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var D=0/0,Se=/^[-+]0x[0-9a-f]+$/i,we=/^0b[01]+$/i,Te=/^0o[0-7]+$/i,je=parseInt;function M(e){if(typeof e=="number")return e;if(he(e))return D;if(A(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=A(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ve(e);var n=we.test(e);return n||Te.test(e)?je(e.slice(2),n?2:8):Se.test(e)?D:+e}var Oe=function(){return G.Date.now()};const E=Oe;var xe="Expected a function",Ie=Math.max,ke=Math.min;function U(e,t,n){var o,r,s,c,a,i,l=0,u=!1,m=!1,g=!0;if(typeof e!="function")throw new TypeError(xe);t=M(t)||0,A(n)&&(u=!!n.leading,m="maxWait"in n,s=m?Ie(M(n.maxWait)||0,t):s,g="trailing"in n?!!n.trailing:g);function y(f){var h=o,S=r;return o=r=void 0,l=f,c=e.apply(S,h),c}function T(f){return l=f,a=setTimeout(j,t),u?y(f):c}function v(f){var h=f-i,S=f-l,L=t-h;return m?ke(L,s-S):L}function b(f){var h=f-i,S=f-l;return i===void 0||h>=t||h<0||m&&S>=s}function j(){var f=E();if(b(f))return R(f);a=setTimeout(j,v(f))}function R(f){return a=void 0,g&&o?y(f):(o=r=void 0,c)}function z(){a!==void 0&&clearTimeout(a),l=0,o=i=r=a=void 0}function K(){return a===void 0?c:R(E())}function k(){var f=E(),h=b(f);if(o=arguments,r=this,i=f,h){if(a===void 0)return T(i);if(m)return clearTimeout(a),a=setTimeout(j,t),y(i)}return a===void 0&&(a=setTimeout(j,t)),c}return k.cancel=z,k.flush=K,k}var Ee=Object.defineProperty,Pe=Object.defineProperties,Ae=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,$e=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,F=(e,t,n)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H=(e,t)=>{for(var n in t||(t={}))$e.call(t,n)&&F(e,n,t[n]);if(W)for(var n of W(t))Ce.call(t,n)&&F(e,n,t[n]);return e},_=(e,t)=>Pe(e,Ae(t)),C=(e,t,n)=>new Promise((o,r)=>{var s=i=>{try{a(n.next(i))}catch(l){r(l)}},c=i=>{try{a(n.throw(i))}catch(l){r(l)}},a=i=>i.done?o(i.value):Promise.resolve(i.value).then(s,c);a((n=n.apply(e,t)).next())});const I=(e,t,n=null)=>{let o=!0;return Re(r=>o?(o=!1,null):e(r),t,n)},Ve=I,Re=(e,t,n=null)=>{let o=n;return $(X(t,()=>(o=e(o),o)))},p=Symbol("AtomTypeSymbol"),d=(e,t)=>{const[n,o]=Q(e,t);return Object.assign((...r)=>r.length===0?n():o(...r),{reflux:Le,[p]:"atom"})},Le=function(e,t,n){const o=this,r=d(e,n);return I(()=>{o(()=>t(r()))},[r]),r[p]="reflux",r},Be=(e,{immediately:t=!0,initValue:n=null}={})=>{const o=d(t?J(()=>e(n)):n);return $(r=>{o(()=>e(r))},n),o[p]="reflect",o},De=(e,{immediately:t=!0,initValue:n=null}={})=>q(o=>{const r=e(o);return t?r:(t=!0,n)},n),Me=(e,{initValue:t=null,immediately:n=!0,deps:o,refetch:r={},tap:s=c=>{}}={})=>{const c=d(t),a=d(!1),i=d(!1),l=q(()=>!a()&&!i());let u=Promise.resolve(!1);const m=(...g)=>C(void 0,[...g],function*({warn:y=!0,cancelCallback:T}=r){l()||(T?T(u):y&&console.warn("Resource Atom: some fetch has been covered; Recommend to add a cancelCallback to some Hook")),a(!0);const v=e().then(b=>(P(()=>{c(()=>b),a(!1),i(!1)}),v===u&&s(b),!0)).catch(b=>(P(()=>{i(b),a(!1)}),b));return u=v,v});return n&&m(),o&&o.length&&I(()=>m(r),o),Object.assign(c,{error:i,loading:a,mutate(g){c(()=>g)},isReady:l,refetch:m,promise:()=>u,[p]:"resource"})};let We=()=>{};const Ue=function(e,t=We){let n=!1;return function(...o){return n?(t&&t(),n):(n=Promise.resolve(e.apply(this,o)).then(r=>(n=!1,r)),n)}};function N(e){return typeof e=="function"?x(e)?e:Be(e()):d(e)}function x(e){return typeof e[p]=="string"}const Fe=(e,t)=>new Promise(n=>setTimeout(()=>n(t),e));function Ne(e,t){const n=x(e)?e:d(e,t),o=(r,s,c)=>{const a=r.findIndex(i=>i===s);if(a>=0){const i=[...r];return c(i,a),i}else return console.warn("Can't find array atom Item: ",s),r};return Object.assign(n,_(H({},{replace(r,s){return n(c=>o(c,r,(a,i)=>{a[i]=s})),this},replaceAll(r,s){return n(c=>{const a=[];c.forEach((l,u)=>l===r&&a.push(u));const i=[...c];return a.forEach(l=>i[l]=s),i}),this},remove(r){return n(s=>o(s,r,(c,a)=>{c.splice(a,1)})),this},removeAll(r){return n(s=>s.filter(c=>c!==r)),this},insert(r,s,c="before"){return n(a=>o(a,s,(i,l)=>{i.splice(c==="before"?l:l+1,0,r)})),this},move(r,s,c){return this.remove(r),this.insert(r,s,c),this},switch(r,s){return n(c=>{const a=[...c],i=n().findIndex(u=>u===r),l=n().findIndex(u=>u===s);if(i===-1||l===-1)throw new Error("ArrayAtom: Please check the Items you want to switch ");return a[i]=s,a[l]=r,a}),this}}),{[p]:"array"}))}function He(e,t){const n=x(e)?e:d(e,{equals:!1}),o=x(e)?e():e;n[p]="object";const r=new Map,s=new Set([p,...Object.keys(o)]);return new Proxy(n,{get(c,a,i){if(!s.has(a))throw new Error(`key: ${a} can't be found in formObject!`);if(r.has(a))return r.get(a);{const l=c.reflux(c()[a],u=>(c()[a]=u,c()));return r.set(a,l),l}},apply(c,a,i){return Reflect.apply(c,a,i)}})}function _e(e,t=150){let n=e();const o=d(n);return I(U(()=>{const r=e();r!==void 0&&o(()=>r)},t),[e]),o}const ze=()=>{const e=new Map;return{register(t,n){if(e.has(t))throw new Error("Blackboard has a same app named "+t.toString());return e.set(t,n)},getApp(t){if(!e.has(t))throw new Error(`Blackboard app ${t.toString()} isn't init yet`);return e.get(t)},delete(t){if(!e.has(t))throw new Error(`Blackboard app ${t.toString()} isn't init yet`);e.delete(t)},check(t){return e.has(t)},destroy(){e.clear()}}},qe=(e,t={})=>{var n,o;t.debounceTime=(n=t.debounceTime)!=null?n:100;const r=d((o=t.initIndex)!=null?o:0),s=d(10),c=Me(()=>e(r(),s),t),a=U(()=>c.refetch(),t.debounceTime),i=l=>{if(l<0||l>=s())return!1;{r(l);//! 页码改变如果迅速的话，那应该不进行请求，而是直接忽略
return a()}};return{currentIndex:r,currentPage:De(()=>r()+1),maxPage:s,prev(){return i(r()-1)},next(){return i(r()+1)},waitForDone(){return C(this,null,function*(){return Fe(t.debounceTime+10).then(c.promise)})},refetch:a,goto:i,currentData:c}},Ke=(e,t)=>{const n=d([],{equals:!1}),o=qe((...r)=>C(void 0,null,function*(){const s=yield e(...r);return n(c=>(c[r[0]]=s,c)),s}),t);return _(H({},o),{resetStack(r=!0){P(()=>{n([]),o.currentIndex(0),r&&o.currentData.refetch()})},dataSlices:n})},Qe=function(e={}){var t,n;const o=Ne(N((t=e.activeIds)!=null?t:[])),r=N((n=e.multi)!=null?n:!0),s=d(new Set(o()));$(()=>{!r()&&o(i=>i.slice(0,1)),s(()=>new Set(o()))});const c=d(new Set,{equals:!1}),a=(i,l)=>{l===void 0&&(l=!s().has(i)),l===!0&&!s().has(i)?o(u=>r()?[...u,i]:[i]):l===!1&&o.removeAll(i)};return{changeSelected:a,register(i,l=!1){c(u=>(u.add(i),u)),a(i,l)},deregister(i){o.removeAll(i),c(l=>(l.delete(i),l))},allRegistered:c,activeIds:s,isSelected:i=>s().has(i)}},Xe=(e,t,n,{on:o=s=>s.addEventListener,off:r=s=>s.removeEventListener}={})=>{o(e).call(e,t,n),Y(()=>{r(e).call(e,t,n)})};export{I as A,Ne as L,N as O,qe as Q,Me as U,Ve as V,Ue as W,Xe as a,_e as c,p as d,d as f,Qe as i,Ke as l,He as o,ze as u,Be as x,Re as z};
